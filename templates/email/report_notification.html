{% extends "email/base_email.html" %}

{% block content %}
<!-- Greeting -->
<h1>Hi {{ user_name|default('there') }},</h1>

<p>Your scheduled report, "{{ question }}", is ready. Here is a summary of the key findings.</p>

<!-- Report Summary Card -->
<div class="card">
    <h3>Report Summary</h3>

    <div class="summary-grid">
        <div class="summary-row">
            <div class="summary-cell summary-label">Query Name</div>
            <div class="summary-cell summary-value">{{ question }}</div>
        </div>
        <div class="summary-row">
            <div class="summary-cell summary-label">Date Executed</div>
            <div class="summary-cell summary-value">{{ generated_at }}</div>
        </div>
        <div class="summary-row">
            <div class="summary-cell summary-label">Run By</div>
            <div class="summary-cell summary-value">{{ user_id|default('Automation Script') }}</div>
        </div>
        <div class="summary-row">
            <div class="summary-cell summary-label">Records Found</div>
            <div class="summary-cell summary-value">{{ rows_count|default('N/A') }}</div>
        </div>
    </div>

    {% if truncated %}
    <div style="margin-top: 16px; padding: 12px; background-color: #fffbeb; border-left: 3px solid #f9cc53; border-radius: 4px;">
        <p style="margin: 0; color: #92400e; font-size: 13px;">
            <strong>Note:</strong> Results truncated to {{ max_rows }} rows out of {{ rows_count }} total records.
        </p>
    </div>
    {% endif %}
</div>

<!-- Attachment Box -->
{% if attachment_name %}
<div class="attachment-box">
    <div class="attachment-icon">
        {% if format == 'pdf' %}
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 2V8H20" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 13H14" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 17H14" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% elif format == 'excel' %}
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 2V8H20" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 13H16" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 17H16" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 9V21" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% else %}
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M14 2V8H20" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {% endif %}
    </div>
    <div class="attachment-details">
        <div class="attachment-name">{{ attachment_name }}</div>
        <div class="attachment-meta">
            {{ format|upper }}{% if attachment_size %}, {{ attachment_size }}{% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-item">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 20V10" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 20V4" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M6 20V14" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <span class="stat-value">{{ rows_count|default('0') }}</span>
        <span class="stat-label">Total Records</span>
    </div>
    <div class="stat-item">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 2V8H20" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <span class="stat-value">{{ format|upper }}</span>
        <span class="stat-label">Format</span>
    </div>
    <div class="stat-item">
        <div class="stat-icon">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 3V16C3 16.5304 3.21071 17.0391 3.58579 17.4142C3.96086 17.7893 4.46957 18 5 18H21" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 14L12 9L16 13L21 8" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>
        <span class="stat-value">{% if attachment_size %}{{ attachment_size.split()[0] }}{% else %}N/A{% endif %}</span>
        <span class="stat-label">{% if attachment_size and attachment_size.split()|length > 1 %}{{ attachment_size.split()[1] }}{% else %}Size{% endif %}</span>
    </div>
</div>

<!-- Pro Tip -->
<div class="card card-yellow-tip">
    <table style="width: 100%; border-collapse: collapse;">
        <tr>
            <td style="width: 40px; vertical-align: top; padding-right: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C10.0222 2 8.08879 2.58649 6.4443 3.6853C4.79981 4.78412 3.51809 6.3459 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C22 10.6868 21.7413 9.38642 21.2388 8.17317C20.7363 6.95991 19.9997 5.85752 19.0711 4.92893C18.1425 4.00035 17.0401 3.26375 15.8268 2.7612C14.6136 2.25866 13.3132 2 12 2Z" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 16V12" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 8H12.01" stroke="#f9cc53" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </td>
            <td style="vertical-align: top;">
                <h3 style="margin: 0 0 8px 0;">Pro Tip</h3>
                <p style="margin: 0; font-size: 14px;">
                    You can customize the date range and filters directly on the dashboard for deeper analysis. Try asking:
                    <em>"Show me sales report for last quarter"</em> or
                    <em>"Generate attendance summary for March 2025"</em>
                </p>
            </td>
        </tr>
    </table>
</div>

<!-- Closing -->
<p style="margin-top: 24px; color: #333333;">
    Thank you for using {{ app_name|default('OryggiAI Chatbot') }}. We're here to help you make data-driven decisions.
</p>
{% endblock %}
