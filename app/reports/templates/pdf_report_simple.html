<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        @page {
            size: A4;
            margin: 1.5cm;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            font-size: 10pt;
            color: #333;
            line-height: 1.5;
            margin: 0;
            padding: 0;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #5DA5DA;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 22pt;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .subtitle {
            margin: 5px 0;
            font-size: 12pt;
            opacity: 0.95;
        }

        .header .date {
            margin-top: 8px;
            font-size: 9pt;
            opacity: 0.9;
        }

        /* KPI Cards Section */
        .kpi-section {
            margin-bottom: 25px;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #5DA5DA;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .kpi-value {
            font-size: 18pt;
            font-weight: 700;
            color: #242c34;
            margin: 5px 0;
        }

        .kpi-label {
            font-size: 9pt;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Charts Section */
        .charts-section {
            margin-bottom: 25px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 15px;
        }

        .chart-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .chart-container h3 {
            margin: 0 0 12px 0;
            font-size: 11pt;
            color: #242c34;
            text-align: center;
            border-bottom: 2px solid #5DA5DA;
            padding-bottom: 8px;
        }

        .chart-container img {
            display: block;
            width: 100%;
            height: auto;
            max-width: 100%;
        }

        /* Metadata Section */
        .metadata {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 20px;
            border-left: 4px solid #5DA5DA;
            border-radius: 4px;
        }

        .metadata-item {
            margin: 5px 0;
            font-size: 9pt;
            display: flex;
            align-items: baseline;
        }

        .metadata-item strong {
            color: #242c34;
            min-width: 120px;
            font-weight: 600;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 9pt;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .data-table th {
            background: linear-gradient(135deg, #242c34 0%, #3a4550 100%);
            color: white;
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 9pt;
            letter-spacing: 0.3px;
        }

        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 8.5pt;
        }

        .data-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .data-table tr:hover {
            background-color: #e9ecef;
        }

        /* Truncation Warning */
        .truncation-warning {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border-left: 4px solid #faa43a;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 9pt;
            color: #856404;
            display: flex;
            align-items: center;
        }

        .truncation-warning strong {
            margin-right: 8px;
        }

        /* SQL Query Display */
        .sql-query {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #5cb85c;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 8pt;
            white-space: pre-wrap;
            word-wrap: break-word;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Section Titles */
        .section-title {
            font-size: 13pt;
            font-weight: 700;
            color: #242c34;
            margin: 25px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #5DA5DA;
        }

        /* Footer */
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #ddd;
            text-align: center;
            font-size: 8pt;
            color: #666;
        }

        /* Print-specific styles */
        @media print {
            .chart-grid {
                page-break-inside: avoid;
            }

            .data-table {
                page-break-inside: auto;
            }

            .data-table tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ title }}</h1>
        <div class="subtitle">Database Query Report</div>
        <div class="date">Generated on {{ generated_at }}</div>
    </div>

    {% if metadata %}
    <div class="metadata">
        <div class="metadata-item">
            <strong>Generated By:</strong>
            <span>{{ metadata.generated_by }} ({{ metadata.user_role }})</span>
        </div>
        {% if metadata.question %}
        <div class="metadata-item">
            <strong>Question:</strong>
            <span>{{ metadata.question }}</span>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if kpis and kpis|length > 0 %}
    <div class="kpi-section">
        <h2 class="section-title">Key Metrics</h2>
        <div class="kpi-grid">
            {% for kpi in kpis[:4] %}
            <div class="kpi-card">
                <div class="kpi-label">{{ kpi.label }}</div>
                <div class="kpi-value">{{ kpi.value }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if charts and charts|length > 0 %}
    <div class="charts-section">
        <h2 class="section-title">Visual Analytics</h2>
        <div class="chart-grid">
            {% for chart in charts %}
            <div class="chart-container">
                <h3>{{ chart.title }}</h3>
                <img src="{{ chart.image }}" alt="{{ chart.title }}">
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if metadata and metadata.sql_query %}
    <h2 class="section-title">SQL Query</h2>
    <div class="sql-query">{{ metadata.sql_query }}</div>
    {% endif %}

    {% if truncated %}
    <div class="truncation-warning">
        <strong>Note:</strong>
        <span>Showing {{ displayed_rows }} of {{ total_rows }} total rows.</span>
    </div>
    {% endif %}

    <h2 class="section-title">Data Results</h2>
    <table class="data-table">
        <thead>
            <tr>
                {% for column in columns %}
                <th>{{ column }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
            <tr>
                {% for cell in row %}
                <td>{{ cell }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="footer">
        <p>Report generated by OryggiAI Chatbot System | {{ total_rows }} total records</p>
    </div>
</body>
</html>
